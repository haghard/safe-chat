[
{
   "type":"record",
   "name":"MsgEnvelope",
   "namespace":"com.safechat.persistent.domain",
   "fields":[
      {
         "name":"correlationId",
         "type":"string"
      },
      {
         "name":"when",
         "type":"long"
      },
      {
         "name":"tz",
         "type":"string"
      },
      {
         "name": "payload",
         "type":[
            {
               "name": "Joined",
               "type": "record",
               "namespace": "com.safechat.persistent.domain",
               "fields": [
                   { "name": "login", "type": "string" },
                   { "name": "pubKey", "type": "string" },
                   { "name": "email", "type": [ "null", "string" ], "default" : null, "doc": "optional email" }
               ]
            },
            {
               "name": "TextAdded",
               "type": "record",
               "namespace": "com.safechat.persistent.domain",
               "fields": [
                   { "name": "user", "type": "string" },
                   { "name": "receiver", "type": "string" },
                   { "name": "text", "type": "string" }
               ]
            },
            {
               "name": "Disconnected",
               "type": "record",
               "namespace": "com.safechat.persistent.domain",
               "fields": [
                 { "name": "login", "type": "string" },
                 { "name": "email", "type": [ "null", "string" ], "default" : null, "doc": "optional email" }
               ]
            },
            {
               "name": "LikedText",
               "type": "record",
               "namespace": "com.safechat.persistent.domain",
               "fields": [
                 { "name": "login", "type": [ "null", "string" ], "default" : null, "doc": "Since v3" },
                 { "name": "seqNum", "type": [ "null", "long" ], "default" : null, "doc": "Since v3" }
               ]
            }
         ]
      }
   ]
},
{
     "type":"record",
     "name":"ChatRoomState",
     "namespace":"com.safechat.persistent.state",
     "fields":[
        {
          "name" : "registeredUsers",
          "type" : {
            "type" : "map",
            "values" : "string",
            "default": []
          },
          "doc": "Registered users and their pub keys"
        },
        {
          "name" : "recentHistory",
          "type" : {
            "type" : "array",
            "items" : "string",
            "default": []
          },
          "doc": "Recent messages"
        }
      ]
  }
]